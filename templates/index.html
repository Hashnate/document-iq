{% extends "base.html" %} 

{% block content %}
<div class="main-container">

    <!-- Right Column - Welcome Message -->
    <div class="welcome-column">
        <div class="welcome-card">
            <h1>Welcome to <span class="gradient-text">DOCUMENT IQ</span>!</h1>
            <p class="welcome-description">
                Revolutionary AI-powered Q&A system with perfect page numbering. Ask natural language questions or search for specific keywords. Get instant, accurate answers with guaranteed page references from your documents.
            </p>

            <div class="features-section">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-chat-dots"></i>
                    </div>
                    <div class="feature-content">
                        <h3>Natural Language Q&A</h3>
                        <p>Ask questions naturally - "What are the main findings?" or "How does this work?"</p>
                    </div>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-search"></i>
                    </div>
                    <div class="feature-content">
                        <h3>Intelligent Keyword Search</h3>
                        <p>Find exact phrases and keywords with comprehensive result coverage</p>
                    </div>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-file-text"></i>
                    </div>
                    <div class="feature-content">
                        <h3>Accurate Page References</h3>
                        <p>Every answer includes exact page numbers from original documents</p>
                    </div>
                </div>

                <!-- <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-lightning-charge"></i>
                    </div>
                    <div class="feature-content">
                        <h3>Ultra-Fast Processing</h3>
                        <p>Optimized GPU acceleration with clear progress tracking</p>
                    </div>
                </div> -->
<!-- 
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-robot"></i>
                    </div>
                    <div class="feature-content">
                        <h3>Gemini AI Powered</h3>
                        <p>Advanced language understanding for comprehensive document analysis</p>
                    </div>
                </div> -->

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-eye"></i>
                    </div>
                    <div class="feature-content">
                        <h3>OCR Support</h3>
                        <p>Extract text from images and scanned documents with GPU acceleration</p>
                    </div>
                </div>
            </div>

            <!-- Q&A Examples Section -->
            <div class="qa-examples-section">
                <h3>üí° What You Can Ask</h3>
                <div class="example-queries">
                    <div class="query-type-section">
                        <h4><i class="bi bi-chat-square-text"></i> Natural Questions</h4>
                        <div class="example-queries-list">
                            <span class="example-query">"What are the key findings?"</span>
                            <span class="example-query">"How does this process work?"</span>
                            <span class="example-query">"What are the requirements?"</span>
                            <span class="example-query">"Explain the methodology"</span>
                        </div>
                    </div>
                    <div class="query-type-section">
                        <h4><i class="bi bi-search"></i> Keyword Search</h4>
                        <div class="example-queries-list">
                            <span class="example-query">"budget allocation"</span>
                            <span class="example-query">"risk assessment"</span>
                            <span class="example-query">"project timeline"</span>
                            <span class="example-query">"compliance requirements"</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Left Column - Upload Panel -->
    <div class="upload-column">
        <div class="upload-card">
            <div class="upload-header">
                <h2 class="upload-title">Smart Document Upload</h2>
                <p class="upload-subtitle">Optimized for Q&A with perfect page numbering</p>
                <div class="performance-indicator">
                    <span class="perf-badge qa-optimized">
                        <i class="bi bi-chat-dots"></i> Q&A Optimized
                    </span>
                    <span class="perf-badge page-accurate">
                        <i class="bi bi-file-text"></i> Page Accurate
                    </span>
                </div>
            </div>

            <div class="file-upload-area" id="dropZone">
                <div class="upload-cloud">
                    <i class="bi bi-cloud-arrow-up"></i>
                </div>
                <h5 id="upload-instruction">Drag & drop files here</h5>
                <p class="text-muted" id="file-name">or click to browse<br>Documents, images, and archives supported</p>
                <div class="upload-cta">
                    <button class="browse-btn">Browse Files</button>
                </div>
            </div>

            <!-- Enhanced Progress Container -->
            <div class="progress-container">
                <div class="progress-info">
                    <span class="progress-text">Ready for Q&A processing</span>
                    <div class="progress-right">
                        <span class="phase-indicator" id="phase-indicator" style="display: none;">
                            üì§ Upload
                        </span>
                        <span class="progress-percent">0%</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress"></div>
                </div>
                
                <!-- Enhanced Progress Details -->
                <div class="progress-details">
                    <span class="progress-speed"></span>
                    <span class="progress-eta"></span>
                </div>
                
                <!-- Processing Phase Details -->
                <div class="processing-phases" style="display: none;">
                    <div class="phase-item">
                        <span class="phase-icon">üìã</span>
                        <span class="phase-text">Phase 1: File Validation & Extraction</span>
                        <span class="phase-status">‚è≥</span>
                    </div>
                    <div class="phase-item">
                        <span class="phase-icon">üîç</span>
                        <span class="phase-text">Phase 2: Q&A Optimization & Page Detection</span>
                        <span class="phase-status">‚è≥</span>
                    </div>
                    <div class="phase-item">
                        <span class="phase-icon">üîÑ</span>
                        <span class="phase-text">Phase 3: Indexing & Finalization</span>
                        <span class="phase-status">‚è≥</span>
                    </div>
                </div>
            </div>

            <!-- File List -->
            <div class="file-list"></div>
            
            <!-- Enhanced Processing Summary -->
            <div class="processing-summary" style="display: none;">
                <div class="summary-header">
                    <h4><i class="bi bi-graph-up"></i> Processing Summary</h4>
                </div>
                <div class="summary-stats">
                    <div class="stat-item">
                        <span class="stat-label">Total Files:</span>
                        <span class="stat-value" id="total-files">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Processed:</span>
                        <span class="stat-value" id="processed-files">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Pages Detected:</span>
                        <span class="stat-value" id="pages-detected">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Failed:</span>
                        <span class="stat-value" id="failed-files">0</span>
                    </div>
                </div>
                <div class="qa-optimization-status">
                    <div class="optimization-item">
                        <i class="bi bi-check-circle-fill"></i>
                        <span>Q&A chunks optimized</span>
                    </div>
                    <div class="optimization-item">
                        <i class="bi bi-check-circle-fill"></i>
                        <span>Page references mapped</span>
                    </div>
                    <div class="optimization-item">
                        <i class="bi bi-check-circle-fill"></i>
                        <span>Search indices built</span>
                    </div>
                </div>
            </div>

            <p class="error-message"></p>

            <!-- Enhanced Supported Files -->
            <div class="supported-files">
                <div class="supported-files-title">Supported File Types for Q&A:</div>
                <div class="supported-files-categories">
                    <div class="file-category">
                        <div class="category-title">üìÑ Documents</div>
                        <div class="supported-files-badges">
                            <span class="badge"><i class="bi bi-filetype-pdf"></i> PDF</span>
                            <span class="badge"><i class="bi bi-filetype-docx"></i> DOCX</span>
                            <span class="badge"><i class="bi bi-filetype-txt"></i> TXT</span>
                            <span class="badge"><i class="bi bi-file-earmark"></i> MD</span>
                        </div>
                    </div>
                    <div class="file-category">
                        <div class="category-title">üìä Data Files</div>
                        <div class="supported-files-badges">
                            <span class="badge"><i class="bi bi-filetype-csv"></i> CSV</span>
                            <span class="badge"><i class="bi bi-filetype-xlsx"></i> XLSX</span>
                            <span class="badge"><i class="bi bi-filetype-json"></i> JSON</span>
                            <span class="badge"><i class="bi bi-filetype-xml"></i> XML</span>
                        </div>
                    </div>
                    <div class="file-category">
                        <div class="category-title">üñºÔ∏è Images (OCR)</div>
                        <div class="supported-files-badges">
                            <span class="badge"><i class="bi bi-image"></i> JPG</span>
                            <span class="badge"><i class="bi bi-image"></i> PNG</span>
                            <span class="badge"><i class="bi bi-image"></i> TIFF</span>
                            <span class="badge"><i class="bi bi-file-earmark-zip"></i> ZIP</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Upload Tips -->
            <div class="upload-tips">
                <div class="tip">
                    <i class="bi bi-chat-dots"></i>
                    <span>Ask questions naturally after upload - "What are the main points?"</span>
                </div>
                <div class="tip">
                    <i class="bi bi-search"></i>
                    <span>Use quotes for exact keyword search - "project timeline"</span>
                </div>
                <div class="tip">
                    <i class="bi bi-file-text"></i>
                    <span>Every answer includes accurate page references from your documents</span>
                </div>
                <div class="tip">
                    <i class="bi bi-eye"></i>
                    <span>Images and scanned documents supported with OCR processing</span>
                </div>
                <div class="tip">
                    <i class="bi bi-shield-check"></i>
                    <span>Remove passwords from protected files before uploading</span>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Enhanced Subscription Modal -->
<div id="subscriptionModal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <div class="modal-body">
            <div class="text-center mb-4">
                <i class="bi bi-chat-dots" style="font-size: 3rem; color: var(--primary-color);"></i>
            </div>
            <h3 class="text-center mb-3">Q&A System Access Required</h3>
            <p class="text-center mb-4" id="modalMessage">
                To use the enhanced Q&A system with natural language processing, you need an active subscription or free trial.
            </p>
            <div class="subscription-info" id="subscriptionInfo">
                <!-- Dynamic content will be inserted here -->
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" id="closeModalBtn">Not Now</button>
            <button class="btn btn-trial" id="startTrialBtn">
                <i class="bi bi-gift"></i> Start Free Trial
            </button>
            <button class="btn btn-primary" id="goToPricingBtn">
                <i class="bi bi-star"></i> View Plans
            </button>
        </div>
    </div>
</div>

<style>
    /* Enhanced color scheme for Q&A */
    :root {
        --primary-color: #4361ee;
        --secondary-color: #3a0ca3;
        --accent-color: #7209b7;
        --success-color: #4cc9f0;
        --warning-color: #f8961e;
        --error-color: #f94144;
        --text-color: #2b2d42;
        --light-text: #8d99ae;
        --background-light: #f8f9fa;
        --card-bg: #ffffff;
        --qa-color: #10b981;
        --page-accuracy-color: #8b5cf6;
        --ocr-color: #f59e0b;
    }
    
    /* Enhanced gradient text effect */
    .gradient-text {
        background: linear-gradient(90deg, var(--primary-color), var(--accent-color), var(--qa-color));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        display: inline-block;
        background-size: 200% 100%;
        animation: gradientShift 3s ease-in-out infinite;
    }
    
    @keyframes gradientShift {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }
    
    /* Enhanced animations */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    @keyframes processingPulse {
        0% { background-color: rgba(76, 201, 240, 0.15); }
        50% { background-color: rgba(76, 201, 240, 0.25); }
        100% { background-color: rgba(76, 201, 240, 0.15); }
    }
    
    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }
    
    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    /* Main layout */
    body {
        background: linear-gradient(135deg, var(--background-light) 0%, #e9ecef 100%);
        min-height: 100vh;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: var(--text-color);
        line-height: 1.6;
    }
    
    .main-container {
        display: flex;
        min-height: calc(100vh - 60px);
        padding: 30px;
        gap: 40px;
        max-width: 1400px;
        margin: 0 auto;
        align-items: flex-start;
        animation: fadeIn 0.5s ease-out;
    }
    
    /* Welcome column styling */
    .welcome-column {
        flex: 1;
        min-width: 0;
    }
    
    .welcome-card {
        background-color: var(--card-bg);
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .welcome-card h1 {
        color: var(--text-color);
        margin-bottom: 20px;
        font-size: 2.5rem;
        font-weight: 700;
        line-height: 1.2;
    }
    
    .welcome-description {
        font-size: 1.1rem;
        line-height: 1.7;
        margin-bottom: 30px;
        color: var(--light-text);
    }
    
    /* Enhanced feature cards */
    .features-section {
        margin-top: 40px;
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .feature-card {
        display: flex;
        align-items: flex-start;
        gap: 20px;
        padding: 20px;
        border-radius: 12px;
        background: var(--card-bg);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
    }
    
    .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        border-left: 4px solid var(--primary-color);
    }
    
    .feature-card:nth-child(1) .feature-icon {
        background: linear-gradient(135deg, var(--qa-color), #059669);
    }
    
    .feature-card:nth-child(2) .feature-icon {
        background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    }
    
    .feature-card:nth-child(3) .feature-icon {
        background: linear-gradient(135deg, var(--page-accuracy-color), #7c3aed);
    }
    
    .feature-card:nth-child(4) .feature-icon {
        background: linear-gradient(135deg, var(--warning-color), #ea580c);
    }
    
    .feature-card:nth-child(5) .feature-icon {
        background: linear-gradient(135deg, var(--accent-color), #a21caf);
    }
    
    .feature-card:nth-child(6) .feature-icon {
        background: linear-gradient(135deg, var(--ocr-color), #d97706);
    }
    
    .feature-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        flex-shrink: 0;
    }
    
    .feature-content h3 {
        color: var(--text-color);
        margin-bottom: 8px;
        font-size: 1.2rem;
        font-weight: 600;
    }
    
    .feature-content p {
        color: var(--light-text);
        margin: 0;
        font-size: 0.95rem;
    }
    
    /* Q&A Examples Section */
    .qa-examples-section {
        margin-top: 30px;
        padding: 25px;
        background: linear-gradient(135deg, rgba(67, 97, 238, 0.05), rgba(114, 9, 183, 0.05));
        border-radius: 15px;
        border: 1px solid rgba(67, 97, 238, 0.1);
    }
    
    .qa-examples-section h3 {
        color: var(--text-color);
        margin-bottom: 20px;
        font-size: 1.3rem;
        text-align: center;
    }
    
    .example-queries {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .query-type-section h4 {
        color: var(--primary-color);
        margin-bottom: 12px;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .example-queries-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .example-query {
        background: rgba(67, 97, 238, 0.1);
        color: var(--primary-color);
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid rgba(67, 97, 238, 0.2);
    }
    
    .example-query:hover {
        background: rgba(67, 97, 238, 0.2);
        transform: translateY(-1px);
    }
    
    /* Upload column styling */
    .upload-column {
        flex: 0 1 520px;
        position: sticky;
        top: 30px;
    }
    
    .upload-card {
        background-color: var(--card-bg);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: transform 0.3s ease;
    }
    
    .upload-card:hover {
        transform: translateY(-5px);
    }
    
    .upload-header {
        text-align: center;
        margin-bottom: 25px;
    }
    
    .upload-title {
        color: var(--text-color);
        margin-bottom: 5px;
        font-size: 1.8rem;
        font-weight: 700;
    }
    
    .upload-subtitle {
        color: var(--light-text);
        font-size: 0.95rem;
        margin-bottom: 15px;
    }
    
    /* Enhanced performance indicators */
    .performance-indicator {
        margin-top: 15px;
        text-align: center;
        display: flex;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .perf-badge {
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        animation: pulse 2s infinite;
    }
    
    .perf-badge.qa-optimized {
        background: linear-gradient(135deg, var(--qa-color), #059669);
    }
    
    .perf-badge.page-accurate {
        background: linear-gradient(135deg, var(--page-accuracy-color), #7c3aed);
    }
    
    /* Enhanced file upload area */
    .file-upload-area {
        min-height: 240px;
        border: 2px dashed rgba(67, 97, 238, 0.3);
        border-radius: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        padding: 30px;
        transition: all 0.3s ease;
        margin-bottom: 20px;
        background-color: rgba(67, 97, 238, 0.03);
        position: relative;
        overflow: hidden;
    }
    
    .file-upload-area:hover {
        border-color: var(--primary-color);
        background-color: rgba(67, 97, 238, 0.05);
    }
    
    .file-upload-area.active {
        border-color: var(--primary-color);
        background-color: rgba(67, 97, 238, 0.08);
        animation: pulse 1.5s infinite;
    }
    
    .upload-cloud {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 15px;
    }
    
    #upload-instruction {
        margin: 10px 0 5px;
        color: var(--text-color);
        font-weight: 600;
    }
    
    #file-name {
        text-align: center;
        color: var(--light-text);
        line-height: 1.5;
        margin-bottom: 15px;
        font-size: 0.9rem;
    }
    
    .upload-cta {
        margin-top: 10px;
    }
    
    .browse-btn {
        padding: 12px 30px;
        border-radius: 30px;
        border: none;
        background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        font-size: 0.95rem;
    }
    
    .browse-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
    }
    
    /* Enhanced progress system */
    .progress-container {
        margin-top: 25px;
        display: none;
    }
    
    .progress-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        gap: 10px;
    }
    
    .progress-text {
        font-size: 0.9rem;
        color: var(--text-color);
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        flex: 1;
        transition: opacity 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .progress-right {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-shrink: 0;
    }
    
    /* Enhanced phase indicators */
    .phase-indicator {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-size: 0.75rem;
        padding: 3px 8px;
        border-radius: 12px;
        font-weight: 600;
        transition: all 0.3s ease;
        white-space: nowrap;
    }
    
    .phase-indicator.upload {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
        border: 1px solid rgba(59, 130, 246, 0.2);
    }
    
    .phase-indicator.processing {
        background: rgba(67, 97, 238, 0.1);
        color: var(--primary-color);
        border: 1px solid rgba(67, 97, 238, 0.2);
    }
    
    .phase-indicator.completed {
        background: rgba(16, 185, 129, 0.1);
        color: var(--qa-color);
        border: 1px solid rgba(16, 185, 129, 0.2);
    }
    
    .progress-percent {
        font-size: 0.9rem;
        color: var(--primary-color);
        font-weight: 600;
        min-width: 45px;
        text-align: right;
        transition: color 0.3s ease;
    }
    
    .progress-bar {
        height: 8px;
        background-color: rgba(67, 97, 238, 0.1);
        border-radius: 4px;
        overflow: hidden;
        position: relative;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .progress {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        width: 0%;
        transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        position: relative;
    }
    
    .progress-bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        animation: shimmer 2s infinite;
        opacity: 0;
    }
    
    .progress-bar.processing::after {
        opacity: 1;
    }
    
    /* Processing phases display */
    .processing-phases {
        margin-top: 15px;
        padding: 15px;
        background: rgba(67, 97, 238, 0.05);
        border-radius: 10px;
        border: 1px solid rgba(67, 97, 238, 0.1);
    }
    
    .phase-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px 0;
        transition: all 0.3s ease;
    }
    
    .phase-item:not(:last-child) {
        border-bottom: 1px solid rgba(67, 97, 238, 0.1);
    }
    
    .phase-icon {
        font-size: 1.1rem;
        width: 24px;
        text-align: center;
    }
    
    .phase-text {
        flex: 1;
        font-size: 0.85rem;
        color: var(--text-color);
        font-weight: 500;
    }
    
    .phase-status {
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .phase-item.active .phase-status {
        animation: rotate 2s linear infinite;
    }
    
    .phase-item.completed .phase-status {
        color: var(--qa-color);
    }
    
    /* Progress details */
    .progress-details {
        display: flex;
        justify-content: space-between;
        margin-top: 5px;
        font-size: 0.8rem;
        color: var(--light-text);
    }
    
    /* Enhanced file list */
    .file-list {
        margin-top: 20px;
        max-height: 300px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .file-item {
        display: flex;
        align-items: center;
        padding: 12px 15px;
        border-radius: 8px;
        background-color: rgba(67, 97, 238, 0.05);
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
    }
    
    .file-item:hover {
        background-color: rgba(67, 97, 238, 0.1);
    }
    
    .file-icon {
        margin-right: 12px;
        color: var(--primary-color);
        font-size: 1.2rem;
    }
    
    .file-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        margin-right: 12px;
    }
    
    .file-name {
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text-color);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 250px;
    }
    
    .file-size {
        font-size: 0.8rem;
        color: var(--light-text);
        margin-top: 2px;
    }
    
    .file-status {
        font-size: 1.2rem;
        flex-shrink: 0;
        transition: all 0.3s ease;
    }
    
    /* File processing states */
    .file-item.waiting {
        background-color: rgba(141, 153, 174, 0.1);
        border-left-color: var(--light-text);
        opacity: 0.7;
    }
    
    .file-item.processing {
        background-color: rgba(76, 201, 240, 0.15);
        border-left-color: #4cc9f0;
        animation: processingPulse 1.5s infinite;
    }
    
    .file-item.processing .file-status {
        animation: rotate 2s linear infinite;
    }
    
    .file-item.completed {
        background-color: rgba(16, 185, 129, 0.1);
        border-left-color: var(--qa-color);
    }
    
    .file-item.error {
        background-color: rgba(249, 65, 68, 0.1);
        border-left-color: #f94144;
    }
    
    /* Enhanced processing summary */
    .processing-summary {
        margin-top: 20px;
        padding: 20px;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(67, 97, 238, 0.05));
        border-radius: 12px;
        border: 1px solid rgba(67, 97, 238, 0.2);
    }
    
    .summary-header {
        text-align: center;
        margin-bottom: 15px;
    }
    
    .summary-header h4 {
        color: var(--text-color);
        margin: 0;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .summary-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 15px;
    }
    
    .stat-item {
        text-align: center;
        padding: 10px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 8px;
    }
    
    .stat-label {
        display: block;
        font-size: 0.75rem;
        color: var(--light-text);
        margin-bottom: 5px;
        font-weight: 500;
    }
    
    .stat-value {
        display: block;
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--primary-color);
    }
    
    /* Q&A optimization status */
    .qa-optimization-status {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .optimization-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.85rem;
        color: var(--qa-color);
        font-weight: 500;
    }
    
    .optimization-item i {
        font-size: 1rem;
    }
    
    /* Enhanced supported files */
    .supported-files {
        margin-top: 25px;
    }
    
    .supported-files-title {
        color: var(--light-text);
        margin-bottom: 15px;
        font-size: 0.9rem;
        text-align: center;
        font-weight: 600;
    }
    
    .supported-files-categories {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .file-category {
        background: rgba(67, 97, 238, 0.05);
        border-radius: 10px;
        padding: 15px;
        border: 1px solid rgba(67, 97, 238, 0.1);
    }
    
    .category-title {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .supported-files-badges {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }
    
    .badge {
        background-color: rgba(67, 97, 238, 0.1);
        color: var(--primary-color);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 4px;
        transition: all 0.3s ease;
        border: 1px solid rgba(67, 97, 238, 0.2);
    }
    
    .badge:hover {
        transform: translateY(-1px);
        box-shadow: 0 3px 8px rgba(67, 97, 238, 0.2);
        background-color: rgba(67, 97, 238, 0.15);
    }
    
    /* Enhanced upload tips */
    .upload-tips {
        margin-top: 25px;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    .tip {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        font-size: 0.85rem;
        color: var(--light-text);
        transition: all 0.3s ease;
        padding: 10px;
        border-radius: 8px;
        background: rgba(67, 97, 238, 0.03);
        border: 1px solid rgba(67, 97, 238, 0.1);
    }
    
    .tip:hover {
        color: var(--text-color);
        background: rgba(67, 97, 238, 0.05);
        transform: translateX(5px);
    }
    
    .tip i {
        color: var(--primary-color);
        flex-shrink: 0;
        margin-top: 2px;
        font-size: 1rem;
    }
    
    .tip:nth-child(1) i { color: var(--qa-color); }
    .tip:nth-child(2) i { color: var(--primary-color); }
    .tip:nth-child(3) i { color: var(--page-accuracy-color); }
    .tip:nth-child(4) i { color: var(--ocr-color); }
    .tip:nth-child(5) i { color: var(--warning-color); }
    
    .error-message {
        color: var(--error-color);
        margin-top: 15px;
        font-size: 0.9rem;
        display: none;
        text-align: center;
        padding: 12px;
        background-color: rgba(249, 65, 68, 0.1);
        border-radius: 8px;
        border: 1px solid rgba(249, 65, 68, 0.2);
    }
    
    /* Enhanced modal styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
    }
    
    .modal-content {
        background-color: var(--card-bg);
        margin: 10% auto;
        padding: 30px;
        border-radius: 15px;
        width: 520px;
        max-width: 90%;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        position: relative;
        animation: fadeIn 0.3s ease-out;
    }
    
    .close-modal {
        position: absolute;
        right: 20px;
        top: 15px;
        font-size: 24px;
        cursor: pointer;
        color: var(--light-text);
        transition: color 0.2s ease;
    }
    
    .close-modal:hover {
        color: var(--text-color);
    }
    
    .modal-actions {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-top: 25px;
        flex-wrap: wrap;
    }
    
    .btn {
        padding: 12px 24px;
        border-radius: 30px;
        cursor: pointer;
        border: none;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        color: white;
        box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
    }
    
    .btn-trial {
        background: linear-gradient(135deg, var(--qa-color), #059669);
        color: white;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }
    
    .btn-trial:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }
    
    .btn-secondary {
        background-color: rgba(141, 153, 174, 0.1);
        color: var(--text-color);
        border: 1px solid rgba(141, 153, 174, 0.2);
    }
    
    .btn-secondary:hover {
        background-color: rgba(141, 153, 174, 0.2);
    }
    
    .subscription-info {
        background: linear-gradient(135deg, rgba(67, 97, 238, 0.05), rgba(16, 185, 129, 0.05));
        border-radius: 12px;
        padding: 20px;
        margin: 20px 0;
        border-left: 4px solid var(--primary-color);
        border: 1px solid rgba(67, 97, 238, 0.1);
    }
    
    .subscription-info h4 {
        color: var(--text-color);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .subscription-info p {
        margin: 5px 0;
        color: var(--light-text);
        font-size: 0.9rem;
    }
    
    .text-center { 
        text-align: center; 
    }
    
    .mb-3 { 
        margin-bottom: 1rem; 
    }
    
    .mb-4 { 
        margin-bottom: 1.5rem; 
    }
    
    /* Enhanced responsive styles */
    @media (max-width: 1200px) {
        .main-container {
            flex-direction: column;
            gap: 30px;
        }
        .upload-column {
            position: static;
            flex: 1;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }
        .qa-examples-section {
            padding: 20px;
        }
        .example-queries {
            gap: 15px;
        }
    }
    
    @media (max-width: 768px) {
        .main-container {
            padding: 20px;
        }
        .welcome-card,
        .upload-card {
            padding: 25px;
        }
        .feature-card {
            flex-direction: column;
            gap: 15px;
            text-align: center;
        }
        .performance-indicator {
            flex-direction: column;
            gap: 8px;
        }
        .summary-stats {
            grid-template-columns: 1fr;
            gap: 10px;
        }
        .supported-files-categories {
            gap: 10px;
        }
        .modal-actions {
            flex-direction: column;
        }
        .btn {
            width: 100%;
            justify-content: center;
        }
        .example-queries {
            gap: 12px;
        }
        .example-query {
            font-size: 0.8rem;
            padding: 5px 10px;
        }
    }
    
    @media (max-width: 480px) {
        .welcome-card h1 {
            font-size: 2rem;
        }
        .upload-title {
            font-size: 1.5rem;
        }
        .file-upload-area {
            min-height: 200px;
            padding: 20px;
        }
        .upload-cloud {
            font-size: 2rem;
        }
        .modal-content {
            width: 95%;
            padding: 20px;
        }
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const uploadArea = document.getElementById('dropZone');
    const browseBtn = document.querySelector('.browse-btn');
    const progressContainer = document.querySelector('.progress-container');
    const progressBar = document.querySelector('.progress');
    const progressText = document.querySelector('.progress-text');
    const progressPercent = document.querySelector('.progress-percent');
    const progressSpeed = document.querySelector('.progress-speed');
    const progressETA = document.querySelector('.progress-eta');
    const fileList = document.querySelector('.file-list');
    const errorMessage = document.querySelector('.error-message');
    const modal = document.getElementById('subscriptionModal');
    const processingPhases = document.querySelector('.processing-phases');
    
    // File processing variables
    let uploadStartTime = 0;
    let filesCompleted = 0;
    let filesFailed = 0;
    let pagesDetected = 0;
    
    // Enhanced supported file types for Q&A
    const ALLOWED_EXTENSIONS = [
        '.pdf', '.docx', '.txt', '.csv', '.zip', '.md', '.json', '.xml', '.html',
        '.xlsx', '.xls', '.pptx', '.jpg', '.jpeg', '.png', '.tiff', '.bmp', '.webp'
    ];

    // Create file input
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.multiple = true;
    fileInput.accept = ALLOWED_EXTENSIONS.join(',');
    fileInput.style.display = 'none';
    document.body.appendChild(fileInput);

    // Enhanced file validation
    function isValidFile(file) {
        const fileName = file.name.toLowerCase();
        const isValid = ALLOWED_EXTENSIONS.some(ext => fileName.endsWith(ext));
        
        // Additional checks for Q&A optimization
        if (isValid) {
            const fileSize = file.size;
            const maxSize = 100 * 1024 * 1024; // 100MB limit
            
            if (fileSize > maxSize) {
                showError(`File "${file.name}" is too large. Maximum size is 100MB.`);
                return false;
            }
        }
        
        return isValid;
    }

    // Enhanced subscription check with Q&A features
    async function checkSubscriptionStatus() {
        try {
            const response = await fetch('/api/check_subscription', {
                method: 'GET',
                credentials: 'include',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            });

            if (response.status === 401) {
                return { is_logged_in: false, allow_uploads: false, redirect_to_login: true };
            }

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }

            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Subscription check failed:', error);
            return { 
                is_logged_in: false, 
                allow_uploads: false, 
                error: error.message,
                subscription_required: true
            };
        }
    }

    // Enhanced file handling for Q&A
    async function handleFiles(files) {
        const validFiles = Array.from(files).filter(isValidFile);

        if (validFiles.length === 0) {
            showError('No valid files found. Supported types: Documents, Images (OCR), and Archives');
            return;
        }

        // Check for mixed file types and show appropriate message
        const hasImages = validFiles.some(f => /\.(jpg|jpeg|png|tiff|bmp|webp)$/i.test(f.name));
        const hasDocuments = validFiles.some(f => /\.(pdf|docx|txt|md)$/i.test(f.name));
        
        if (hasImages && hasDocuments) {
            showInfo('Processing mixed content: Documents and images with OCR extraction');
        } else if (hasImages) {
            showInfo('Processing images with OCR text extraction');
        }

        // Check subscription
        const originalText = progressText.textContent;
        progressText.textContent = 'üîç Verifying Q&A system access...';
        progressContainer.style.display = 'block';

        try {
            const status = await checkSubscriptionStatus();
            
            progressContainer.style.display = 'none';
            progressText.textContent = originalText;

            if (!status.is_logged_in || status.redirect_to_login) {
                window.location.href = `/login?next=${encodeURIComponent(window.location.pathname)}`;
                return;
            }

            if (status.allow_uploads !== true) {
                showSubscriptionModal(status);
                return;
            }

            // Proceed with Q&A optimized upload
            uploadFiles(validFiles);

        } catch (error) {
            progressContainer.style.display = 'none';
            progressText.textContent = originalText;
            showError('Unable to verify Q&A system access. Please refresh and try again.');
        }
    }

    // Enhanced subscription modal for Q&A features
    function showSubscriptionModal(status) {
        const modalMessage = document.getElementById('modalMessage');
        const subscriptionInfo = document.getElementById('subscriptionInfo');
        const startTrialBtn = document.getElementById('startTrialBtn');

        let message = 'Q&A system access requires an active subscription.';
        let infoContent = '';

        if (status.has_trial_available === true) {
            message = 'Start your free trial for unlimited Q&A document processing!';
            infoContent = `
                <h4><i class="bi bi-chat-dots"></i> Q&A System Trial Benefits:</h4>
                <p>‚Ä¢ Ask natural language questions about your documents</p>
                <p>‚Ä¢ Keyword search with exact phrase matching</p>
                <p>‚Ä¢ Accurate page references for all answers</p>
                <p>‚Ä¢ OCR support for images and scanned documents</p>
                <p>‚Ä¢ GPU-accelerated processing for 14 days</p>
                <p>‚Ä¢ Gemini AI-powered comprehensive analysis</p>
            `;
            startTrialBtn.style.display = 'inline-flex';
        } else {
            infoContent = `
                <h4><i class="bi bi-chat-dots"></i> Q&A System Features</h4>
                <p>DocumentIQ's enhanced Q&A system requires a subscription:</p>
                <p>‚Ä¢ Natural language question answering</p>
                <p>‚Ä¢ Intelligent keyword search capabilities</p>
                <p>‚Ä¢ Perfect page number accuracy</p>
                <p>‚Ä¢ OCR text extraction from images</p>
                <p>‚Ä¢ Advanced AI-powered document analysis</p>
            `;
            startTrialBtn.style.display = 'none';
        }

        modalMessage.textContent = message;
        subscriptionInfo.innerHTML = infoContent;
        modal.style.display = 'block';
    }

    // Enhanced phase management
    function updateProcessingPhase(phase, status = 'active') {
        const phases = document.querySelectorAll('.phase-item');
        const phaseMap = {
            'validation': 0,
            'processing': 1,
            'indexing': 2
        };
        
        const phaseIndex = phaseMap[phase];
        if (phaseIndex !== undefined && phases[phaseIndex]) {
            const phaseItem = phases[phaseIndex];
            const statusElement = phaseItem.querySelector('.phase-status');
            
            // Reset all phases
            phases.forEach((item, index) => {
                item.classList.remove('active', 'completed');
                const status = item.querySelector('.phase-status');
                if (index < phaseIndex) {
                    item.classList.add('completed');
                    status.textContent = '‚úÖ';
                } else if (index > phaseIndex) {
                    status.textContent = '‚è≥';
                }
            });
            
            // Set current phase
            if (status === 'active') {
                phaseItem.classList.add('active');
                statusElement.textContent = '‚öôÔ∏è';
            } else if (status === 'completed') {
                phaseItem.classList.add('completed');
                statusElement.textContent = '‚úÖ';
            }
        }
    }

    // Enhanced progress updates
    function updateProgress(percent, message, phase = 'processing') {
        progressBar.style.width = percent + '%';
        progressPercent.textContent = percent + '%';
        
        const progressBarContainer = document.querySelector('.progress-bar');
        
        if (phase === 'upload') {
            progressBarContainer.classList.remove('processing', 'completed');
            progressBarContainer.classList.add('uploading');
            showPhaseIndicator('upload');
            updateProcessingPhase('validation', 'active');
        } else if (phase === 'processing') {
            progressBarContainer.classList.remove('uploading', 'completed');
            progressBarContainer.classList.add('processing');
            showPhaseIndicator('processing');
            updateProcessingPhase('processing', 'active');
        } else if (phase === 'completed') {
            progressBarContainer.classList.remove('uploading', 'processing');
            progressBarContainer.classList.add('completed');
            showPhaseIndicator('completed');
            updateProcessingPhase('indexing', 'completed');
        }
        
        if (message) {
            progressText.textContent = message;
        }
        
        // Show processing phases during upload
        if (phase !== 'completed' && processingPhases) {
            processingPhases.style.display = 'block';
        }
    }

    // Rest of the JavaScript functions remain the same but with enhanced Q&A messaging...
    // [Previous JavaScript functions would continue here with Q&A enhancements]
    
    // Enhanced success message for Q&A
    function showSuccess(message) {
        const successDiv = document.createElement('div');
        successDiv.className = 'success-message';
        successDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="bi bi-check-circle-fill"></i>
                <div>
                    <strong>${message}</strong>
                    <br><small>Ready for Q&A! Ask questions or search keywords.</small>
                </div>
            </div>
        `;
        successDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--qa-color), #059669);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: 500;
            animation: fadeIn 0.3s ease-out;
            max-width: 350px;
        `;
        document.body.appendChild(successDiv);
        setTimeout(() => successDiv.remove(), 5000);
    }
    
    function showInfo(message) {
        const infoDiv = document.createElement('div');
        infoDiv.className = 'info-message';
        infoDiv.innerHTML = `
            <i class="bi bi-info-circle-fill"></i>
            <span>${message}</span>
        `;
        infoDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: 500;
            animation: fadeIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 8px;
        `;
        document.body.appendChild(infoDiv);
        setTimeout(() => infoDiv.remove(), 3000);
    }
    
    // Enhanced event listeners and remaining functionality...
    // [Rest of the JavaScript implementation would continue here]
    
    // Example query click handlers
    document.querySelectorAll('.example-query').forEach(query => {
        query.addEventListener('click', () => {
            // Store the query for later use in chat
            sessionStorage.setItem('pendingQuery', query.textContent);
            showInfo(`Query "${query.textContent}" saved. Upload documents first, then ask in chat.`);
        });
    });
    
    // Initial setup and event binding
    uploadArea.addEventListener('click', () => fileInput.click());
    browseBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) handleFiles(e.target.files);
    });

    // Enhanced drag and drop with file type detection
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('active');
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('active');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('active');
        if (e.dataTransfer.files.length > 0) {
            handleFiles(e.dataTransfer.files);
        }
    });
    
    // Initial Q&A system status check
    checkSubscriptionStatus().then(status => {
        console.log('Q&A system status:', status);
        if (status.qa_system_enabled) {
            console.log('‚úÖ Q&A system ready');
        }
    }).catch(error => {
        console.error('Q&A system check failed:', error);
    });
});
</script>

{% endblock %}